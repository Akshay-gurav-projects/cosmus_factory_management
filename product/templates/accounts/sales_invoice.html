{% extends 'product/base.html' %} 
{% load static %} 

{% block body %} 
<div>
        <!-- <h2>Sales invoice</h2> -->
      <form class="mt-4" action="" method="POST">
          {% csrf_token %}
          <div class="d-flex mb-3">
            <label for="" class="form-label px-2">Type:</label>
            <input type="text" class="item-select" name="purchase_number" id="id_purchase_number" value="Finish Goods"
              maxlength="255" readonly>
          </div>
          <div class="d-flex mb-3">
            <div class="d-flex mb-3">
              <label for="" class="form-label px-2">Sales No:</label>
              {% if master_form.instance.id %}
              <input type="text" class="item-select" name="purchase_number" id="id_purchase_number"
                value="{{master_form.instance.purchase_number}}" maxlength="255" required readonly>
              {% elif not master_form.instance.id %}
              <input type="text" class="item-select" name="purchase_number" id="id_purchase_number"
                value="{{master_form.purchase_number.initial}}" maxlength="255" required>
              {% endif %}
            </div>
            <span id="SupplierError" class="error-messages"></span>
            <div class="d-flex ms-3">
              <label for="id_supplier_invoice_number" class="item-form">Buyer Inv No :</label>
              {% if master_form.instance.id %}
              <input type="text" class="item-select" name="supplier_invoice_number" id="id_supplier_invoice_number"
                value="{{master_form.instance.supplier_invoice_number}}" maxlength="255" readonly>
              {% elif not master_form.instance.id %}
              <input type="text" class="item-select" name="supplier_invoice_number" id="id_supplier_invoice_number"
                value="{{master_form.instance.supplier_invoice_number}}" maxlength="255" required aria-required="true">
              {% endif %}
            </div>
            <div class="d-flex ms-3">
              <label for="id_GST_numbers" class="item-form">Company GST No :</label>
              <input type="text" class="item-select" name="GST_numbers" id="id_company_GST_numbers" value="27AAACG20210238"
                maxlength="50" readonly>
            </div>
          </div>
          <div class="mb-3 d-flex">
            <<div class="d-flex mb-3">
              <label for="id_ledger_type" class="me-3" >ledger Type :</label>
              <input type="text" class="item-select" name="ledger_type" id ="id_ledger_type" value="{{master_form.instance.ledger_type}}" maxlength="50" default='Sales' readonly required placeholder="Sales" >
          </div>
          <span id="purchaseError" class="error-messages"></span>
          <div class="d-flex ms-3">
              <label for="id_party_name" class="me-3" >Party A/C Name :</label>
        
              <select class="product2Select text-dark" name="party_name" required id="id_party_name">
                  {% if master_form.instance.id %}
                  {% for x in party_names %}
                  <option value="{{x.id}}">{{x.name}}</option>
                  {% endfor %}
                  {% elif not master_form.instance.id %}
                  <option value=""></option>
                  {% for x in party_names %}
                  <option value="{{x.id}}">{{x.name}}</option>
                  {% endfor %}
                  {% endif%}
              </select>
          
            
          </div>
              <button type="button" class="itemCreate_btn popup-trigger" onclick="openPurchasePartyPopup()">+</button>
       
          <div class="d-flex ms-3">
              <label for="id_GST_number" class="me-2" >Party GST No :</label>
              <input type="text" class="item-select" name="GST_number" id ="id_GST_number"  value="{% if master_form.instance.id %}{{ master_form.instance.party_name.Gst_no }}{% endif %}" maxlength="15" readonly required>
          </div>
          </div>
          
   
    <div class="d-flex mb-3">
      <label for="" class="form-label px-2">Party A/C Name: </label>
      <input type="text" class="item-select mx-3" value="" name="" maxlength="50" required id="">
    </div>

    <table class="table table-striped table-hover table-responsive">
      <thead class="name_absolute">
        <tr>
          <th>NO</th>
          <th>Model Names</th>
          <th>Color</th>
          <th>SKU No</th>
          <th>QTY</th>
          <th>MRP</th>
          <th>Customer Price/units</th>
          <th>Treade Discount</th>
          <th>Spl Dlr Discount</th>
          <th>Taxable Value</th>
          <th>Gst</th>
          <th>CGST</th>
          <th>SGST/IGST</th>
          <th>NRP Including GST</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody class="mainTableList">
        <tr>
          <td>1680 Arpan</td>
          <td>Navy</td>
          <td>Shades-2</td>
          <td>1,255.00 </td>
          <td></td>
          <td>Meter</td>
          <td> 7,53,000.00 dr</td>
        </tr>
        
      </tbody>
      <tbody>
        <tr>
            <td class="text-center fw-bold" ><span>Total</span></td>
            <td colspan="3"></td>
            <td> <input type="number" class="purchase-input" style="border: 1px solid red;" name="grand_quantity" id ="id_grand_quantity" value="" maxlength="50" step=".01" readonly></td>
            <td colspan="4"></td>
            <td><input type="number" class="purchase-amount" style="border: 1px solid red;"  name="grand_taxableAmount" id ="id_grand_taxableAmount" value="" maxlength="50" step=".01" readonly ></td>
            <td></td>
            <td><input type="number" class="purchase-input" style="border: 1px solid red;" name="grand_cgst" id ="id_grand_cgst" value="" maxlength="50" step=".01" readonly></td>
            <td><input type="number" class="purchase-input" style="border: 1px solid red; " name="grand_Sgst" id ="id_grand_sgst" value="" maxlength="50" step=".01" readonly > </td>
            <td> <input type="number" class="purchase-amount" style="border: 1px solid red;" name="grand_amount" id ="id_grand_amount" value="" maxlength="50" step=".01" readonly></td>
        </tr>
    </tbody>
    </table>

    
    <div class="row">
      <div class="col-lg-9">
          <div class="ms-2">
              <input type="number" class="product_row" name="productRow" id="id_productRow" value="1">
              <button type="button" class="item-btn mb-3" id="addRowButton">Add +</button>
          </div>

          <table class="table table-striped table-hover table-bordered table-responsive">
            <thead class="name_absolute">
              <tr>
                <th>Taxable Value</th>
                <th colspan="2">CGST</th>
                <th colspan="2">SGST/IGST</th>
              </tr>
            <tr>
              <th></th>
              <th>Rate</th>
              <th>Amount</th>
              <th>Rate</th>
              <th>Amount</th>
            </tr>
            </thead>
            <tbody class="mainTableList">
              <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
              </tr>
              <tr class="Total">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
              </tr>
            </tbody>

          </table>
      </div>
    <div class="col-lg-3">
      <div class="mb-4">
          <div class=" mb-3">
              <label  class="purchase-lable fw-bold">Gross total</label>
              <span class="purchase-span">
                  <input type="number" class="purchaseTableLabel-Gtotal  purchase-amounts" name="gross_total" id ="id_gross_total" value="{{master_form.instance.gross_total | default_if_none:''}}" maxlength="50" step=".01" readonly >
              </span>           
          </div>
          <div class=" mb-3">
            <label class="purchase-lable fw-bold">Cash Disct 3%</label>
            <span class="purchase-span">
                <input type="number" class="purchaseTableLabel-transport  purchase-amounts" name="fright_transport" id ="id_fright_transport" value="{{master_form.instance.fright_transport | default_if_none:'0'}}" maxlength="50" step=".01" required >
            </span>
        </div>
          <div class=" mb-3">
              <label class="purchase-lable fw-bold">Fright & Transport</label>
              <span class="purchase-span">
                  <input type="number" class="purchaseTableLabel-transport  purchase-amounts" name="fright_transport" id ="id_fright_transport" value="{{master_form.instance.fright_transport | default_if_none:'0'}}" maxlength="50" step=".01" required >
              </span>
          </div>
          <div class=" mb-3">
              <input type="hidden" id="temp_grand_total" value="">
              <label class="purchase-lable fw-bold">Round Of </label>
              <span class="purchase-span">
                  <input type="number" class="purchaseTableLabel-roundOf  purchase-amounts" name="round_off" id ="id_round_off" value="" maxlength="50" step=".01" readonly required>
              </span> 
          </div>
      
          <div class=" mb-3">
              <label class="purchase-lable fw-bold">Grand total</label>
              <span class="purchase-span"><input type="number" class="purchaseTableLabel-total purchase-amounts" name="grand_total" value="{{master_form.instance.grand_total | default_if_none:''}}" id="id_grand_total" step=".01" readonly required></span> 
          </div>
      </div>
    </div>
    </div>
  <button type="submit" class="ms-5 newProductCreateBtn" id="parentFormClick">Submit</button>


  </div>

  <script>
  $(document).ready(function() {
  calculateValues();

  // Function to calculate the values
  function calculateValues() {
    var grossTotal = 0;
    var splDiscount = 0;
    var grandTotal = 0;
    var taxableValue = 0;
    var cgstValue = 0;
    var sgstValue = 0;
    var netTotalValue = 0;

    // Iterate through each row in the table
    $('#product-table tbody tr').each(function() {
      var qty = parseFloat($(this).find('td:eq(3)').text());
      var mrp = parseFloat($(this).find('td:eq(4)').text());
      var cpPerUnit = parseFloat($(this).find('td:eq(5)').text());
      var trederDiscount = parseFloat($(this).find('td:eq(6)').text().replace('%', '')) / 100;
      var splDlrDiscount = parseFloat($(this).find('td:eq(7)').text().replace('%', '')) / 100;

      var totalCost = qty * cpPerUnit;
      var totalAfterTrederDiscount = totalCost * (1 - trederDiscount);
      var netPrice = totalAfterTrederDiscount * (1 - splDlrDiscount);

      // Update the Net Price column in the table
      $(this).find('td:eq(8)').text(netPrice.toFixed(2));

      grossTotal += netPrice;
      splDiscount += netPrice* 0.03;
      grandTotal += netPrice - (netPrice* 0.03);
      taxableValue +=  (netPrice - (netPrice* 0.03))* 0.18;
      cgstValue += (netPrice - (netPrice* 0.03));
      sgstValue += netPrice - (netPrice* 0.03);
    });

    // Update the elements in the HTML
    $('#grossTotal').text(grossTotal.toFixed(2));
    $('#splTotal').text(splDiscount.toFixed(2));
    $('#grandValue').text(grandTotal.toFixed(2));
    $('#taxableValue').text((grandTotal- taxableValue).toFixed(2));
    $('#cgstValue').text((cgstValue * 0.09).toFixed(2));
    $('#sgstValue').text((sgstValue* 0.09).toFixed(2));
    $('#netTotalValue').text((grandTotal).toFixed(2));
    $('#netValue').text((grandTotal + 150).toFixed(2));
  }
});

</script>

{% endblock body %}
